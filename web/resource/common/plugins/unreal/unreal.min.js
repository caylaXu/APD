function ConvertRatio(e){if("string"==typeof e&&e.indexOf("x")>=0){var t=e.split("x"),n=parseInt(t[0]),a=parseInt(t[1]);e=a/n}else e=parseFloat(e);return e}function GetTextWidth(e){e=$(e);var t=parseInt(e.css("padding-left")),n=parseInt(e.css("padding-right")),a=parseInt(e.css("font-size")),r=parseInt(e.css("letter-spacing")),i=e.text(),o=i.length,s=mb_strlen(i),l=s-o,c=o-l,d=l*a+c*Math.floor(a/2+1)+r*o+t+n+1;return d}function mb_strlen(e){for(var t,n,a=0,t=0;t<e.length;t++)n=e.charCodeAt(t),a+=isDbcCase(n)?1:2;return a}function isDbcCase(e){return e>=32&&127>=e?!0:e>=65377&&65439>=e?!0:!1}function GenerateList(e,t){var n=$(),a=function(e,t){return template(t,e)};return"string"==typeof t&&"#"==t[0]?t=t.slice(1):"string"==typeof t&&"<"==t[0]&&(a=template.compile(t)),$.isArray(e)||(e=[e]),$.each(e,function(e,r){var i=a(r,t);i=$(i).data("data",r),n=n.add(i)}),n}var Unreal={};$.support.transition=function(){var e=document.createElement("bootstrap"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var n in t)if(void 0!==e.style[n])return{end:t[n]};return!1}(),$.fn.transitionEnd=function(e){var t=this;$.support.transition?$(this).one($.support.transition.end,function(){e.call(t)}):e.call(t)},$.fn.serializeJson=function(){function e(e,t){if(void 0==n[e])n[e]=t;else if($.isArray(n[e]))!!t&&n[e].push(t);else{var a=[];!!n[e]&&a.push(n[e]),!!t&&a.push(t),n[e]=a}}var t=$(this);if(!t.is("form")){t.eq(0).trigger("data.beforeserialize");var n=$("<form></form>").append(t.clone()).serializeJson();return t.eq(0).trigger("data.afterserialize",n),n}t.trigger("data.beforeserialize");var a=t.find("[disabled]");a.prop("disabled",!1);var r=t.find(".single-checkbox").not(":checked");r.prop("checked",!0).val("0");var n={},i=t.serializeArray();return $.each(i,function(t,n){e(n.name,n.value)}),a.prop("disabled",!0),r.prop("checked",!1).val("1"),t.trigger("data.afterserialize",n),n},$.fn.setValue=function(e){var t=$(this);return t.is("select")?(t.find("option").filter(function(){var t=$(this).val();return $.isArray(e)?e.includes(t):t==e}).prop("selected",!0),t.data("value",e)):t.is("[type=radio]")?(t.filter(function(){return $(this).val()==e}).prop("checked",!0),t.trigger("set.appearance")):t.is("[type=checkbox]")?(t.filter(function(){return e.includes($(this).val())}).prop("checked",!0),t.filter(function(){return!e.includes($(this).val())}).prop("checked",!1),t.trigger("set.appearance")):t.is(".form-control-text")?t.text(e):t.val(e),t.trigger("set.value",{value:e}),t},$.fn.loadData=function(e,t){var n=$(this);return e?(n.trigger("data.beforeload",e),$.each(e,function(e,a){var r=n.find("[name='"+e+"']");return t&&(r=n.find("[name]").filter(function(){var t=$(this).attr("name").toLowerCase();return t==e})),0==r.length?!0:(r.setValue(a),void 0)}),n.trigger("data.afterload",e),n):n};var _post=$.post;$.post=function(e,t,n,a){return 0==e.indexOf("/")&&window.HOST&&(e=HOST+e),"function"==typeof t&&(a=n,n=t,t=null),a=a||"json",_post(e,t,n,a).done(function(e){0!=e.Result&&alert(e.Msg,"error")}).fail(function(){alert("请求失败，请重试")})};var _get=$.get;$.get=function(e,t,n,a){return 0==e.indexOf("/")&&window.HOST&&(e=HOST+e),"function"==typeof t&&(a=n,n=t,t=null),a=a||"json",_get(e,t,n,a).done(function(e){0!=e.Result&&alert(e.Msg,"error")}).fail(function(){alert("请求失败，请重试")})},$.reload=function(e){e=e||0,e=1e3*e,setTimeout(function(){window.location.reload()},e)},Array.prototype.includes||(Array.prototype.includes=function(e){return $.inArray(e,this)>-1}),$("body").on("reset","form",function(){var e=$(this);setTimeout(function(){e.trigger("reseting")},10)}),Unreal.ajax=function(e){var t=this;this.eventHandler=$({}),this.id=0,this.start=function(n){var a=$.extend(!0,{},this._defaults,e);a=$.extend(!0,{},a,n),this.onsuccess=function(e,t){a.badResponse(t)!==!1?a.success(t):a.failed(t)},this.onerror=a.error,this.onend=a.end;var r=this.id;this.eventHandler.off("success."+r).off("error."+r).off("end."+r),a.onlyLast&&(this.id++,r=this.id),this.eventHandler.on("success."+r,this.onsuccess).on("error."+r,this.onerror).on("end."+r,this.onend),a.loading.start(),$.ajax({type:a.type,dataType:a.dataType,url:a.url,async:!0,data:a.data,beforeSend:a.beforeSend,success:function(e){t.eventHandler.trigger("success."+r,e)},error:function(){t.eventHandler.trigger("error."+r)}}).always(function(){a.loading.end(),t.eventHandler.trigger("end."+r)})}},Unreal.ajax.prototype._defaults={type:"get",dataType:"json",data:"",url:"/",beforeSend:function(){},error:function(){},badResponse:function(){},success:function(){},failed:function(){},end:function(){},onlyLast:!0,loading:{start:function(){},end:function(){}}},Unreal.ajax.set=Unreal.ajax.prototype.set=function(e){$.extend(!0,Unreal.ajax.prototype._defaults,e)},Unreal.tick=function(e){var t={start:function(){},tick:function(){},end:function(){},during:60,interval:1e3};t=$.extend(!0,t,e);var n=t.during;t.start(),t.tick(n);var a=setInterval(function(){return n--,t.tick(n),0>=n?(clearInterval(a),t.end(),!1):void 0},t.interval)},Unreal.tab=function(e){function t(e,t,n){var a=n||250;e.length>0?e.fadeOut(a,function(){t.fadeIn(a).trigger("change.open")}).trigger("change.close"):t.fadeIn(a).trigger("change.open")}var n={tab:".tab",tab_active:"active",trigger:"click",group:"siblings",during:250};n=$.extend(!0,n,e),Unreal.tab.init||(Unreal.tab.init=!0,$("body").on(n.trigger,n.tab,function(){var e=$(this),a=$.extend(!0,{},n,e.data());if("hover"==a.trigger&&(a.trigger="mouseover"),e.is("."+a.tab_active))return e.trigger("change.on"),!0;var r=function(){return"siblings"==a.group?e.siblings():$(".tab[data-group="+a.group+"]")}(),i=r.filter("."+a.tab_active);i.removeClass(a.tab_active).trigger("change.off"),e.addClass(a.tab_active).trigger("change.on"),t($(i.data("for")),$(e.data("for")),a.during)}))},Unreal.tab(),Unreal.fixedSize=function(e,t){e=e||"[fixed-size]";var n=t||"1";$(e).each(function(){function e(){r.data("fixed-height")?(a=r.data("fixed-height"),r.removeData("fixed-height")):(a=t(),r.is("[sametoall]")&&r.siblings().data("fixed-height",a)),r.outerHeight(a)}function t(){var e=r.attr("fixed-size");e&&(n=e);var t=ConvertRatio(n);return r.outerWidth()*t}var a,r=$(this);return r.data("f_s_ready")?!0:(r.data("f_s_ready",!0),$(window).on("resize.fixedsize",function(){e()}).trigger("resize.fixedsize"),void 0)})},Unreal.fixedSize(),Unreal.mobileFixed=function(e){if(e=e||"#mobile-viewport",0==$(e).length)return!1;var t=$("header.fixed").outerHeight(),n=$("footer.fixed").outerHeight();$("header.fixed").css({position:"relative","margin-bottom":-1*t}),$("footer.fixed").css({position:"relative","margin-top":-1*n}),$(e).css({"padding-top":t,"padding-bottom":n}),$(window).on("resize.mobilefixed",function(){var t=$(window).height();$(e).outerHeight(t)}).trigger("resize.mobilefixed")},Unreal.mobileFixed(),Unreal.imgFill=function(e){e=e||".img-fill",$(e).each(function(){var e=$(this);e.one("load",function(){e.css({width:"100%",height:"auto",position:"relative",top:0,left:0}),e.parent().css({overflow:"hidden"});var t=e.width(),n=e.height(),a=e.parent().height(),r=e.data("ratio");r&&(a=t*r);var i=a*t/n;if(n>a){var o=-1*(n-a)/2;e.css({top:o})}else if(a>n){var o=-1*(i-t)/2;e.css({width:"auto","max-width":"none",height:a,left:o})}}),this.complete&&e.trigger("load")})},Unreal.imgFill(),Unreal.message=function(e,t,n){function a(){o.removeClass("on"),setTimeout(function(){o.remove()},500)}var r=function(){return Unreal.message.state&&Unreal.message.state[t]?'<img src="'+Unreal.message.state[t]+'" >':""}(),i=function(){return 0==$(".sidebar").length?"":$(".sidebar").is(".open")?'style="margin-left: 210px;"':'style="margin-left: 80px;"'},o=$('<div class="message ie-shadow"><div '+i()+">"+r+"<p>"+e+"</p></div></div>");o.appendTo("body").show().addClass("on");var s=n;"undefined"==typeof s&&(s=2500),0!=s&&setTimeout(a,s),setTimeout(function(){$("body").on("click.offmessage",function(){a(),$("body").off("click.offmessage")})},0)},Unreal.message.set=function(e){Unreal.message.state||(Unreal.message.state={});for(var t in e)Unreal.message.state[t]=e[t]},Unreal.loading=function(e){var t,n=this,a=function(){return Unreal.loading.img?'<img src="'+Unreal.loading.img+'" >':""}(),r=function(){return 0==$(".sidebar").length?"":$(".sidebar").is(".open")?'style="margin-left: 210px;"':'style="margin-left: 80px;"'};return this.start=function(){return t&&t.remove(),t=$('<div class="message ie-shadow"><div '+r()+">"+a+"<p>"+e+"</p></div></div>"),t.appendTo("body").show().addClass("on"),n},this.end=function(){t.removeClass("on"),setTimeout(function(){t.remove()},500)},n},Unreal.loading.set=function(e){Unreal.loading.img=e},Unreal.upload=function(e){var t={target:"[type=file]",url:"",onstart:function(){console.log("上传开始")},callback:function(){console.log("上传成功")},onend:function(){console.log("上传结束")},params:{},autoUpload:!0,maxSize:10,clip:!1};$.extend(!0,t,e),Unreal.upload.handler||(Unreal.upload.handler=$({})),Unreal.upload.requestId||(Unreal.upload.requestId=1),Unreal.upload.iframe||(Unreal.upload.iframe=$('<iframe name="upload-iframe" class="remove"></iframe>'),Unreal.upload.iframe.appendTo("body"));Unreal.upload.iframe;$("body").on("change",t.target,function(){var e=$(this);if(!e.val())return!1;var n=this.files,a=0;if(n)a=n[0].size;else try{var r=new ActiveXObject("Scripting.FileSystemObject"),i=r.getFile(this.value);a=i.size}catch(i){}if(a>1024*t.maxSize*1024)return Unreal.message("文件大小不能超过"+t.maxSize+"M","error"),!1;var o=Unreal.upload.requestId,s=$('<form enctype="multipart/form-data" target="upload-iframe" class="remove" action="'+t.url+'" method="post"></form>');s.appendTo("body"),$('<input type="hidden" name="RequestId" >').val(o).appendTo(s),$('<input type="hidden" name="CallbackFunction" >').val("window.parent.Unreal.upload.callback").appendTo(s);for(var l in t.params){var c=t.params[l];"function"==typeof c&&(c=c.call(e));var d=$('<input type="hidden" name="'+l+'" >').val(c);d.appendTo(s)}Unreal.upload.handler.on("success"+o,function(n,a){t.callback.call(e,a),e.removeAttr("disabled"),t.onend.call(e)}),Unreal.upload.start=function(){if(t.onstart.call(e)!==!1){var n=e.clone().insertAfter(e);e.appendTo(s),s.submit(),Unreal.upload.requestId++,e.val("").attr("disabled","disabled").insertAfter(n),n.add(s).remove()}},t.autoUpload&&Unreal.upload.start()}),Unreal.upload.callback=function(e,t,n,a,r){Unreal.upload.handler.trigger("success"+e,{Result:t,Msg:n,Data:{ImgSrc:a,ImgId:r}})}},$("body").on("change keyup","[data-render]",function(e){function t(e,t){e.is("img")?t.attr("src",e.attr("src")):t.text(e.val())}e.stopPropagation();var n=$(this),a=n.data();if(a.container)$(a.container).each(function(){var e=$(this);e.is("iframe")&&(e=$(this.contentDocument));var r=e.find(a.render);t(n,r)});else{var r=$(a.render);t(n,r)}}),$("body").on("set.appearance",".checkbox,.radio",function(e){e.stopPropagation();var t=$(this);t.find("input").is(":checked")?t.addClass("checked"):t.removeClass("checked")}).on("change",".checkbox,.radio",function(){var e=$(this),t=e.find("input"),n=t.attr("name"),a=e.parents("form").find('[name="'+n+'"]');a.length?a.trigger("set.appearance"):e.trigger("set.appearance")}).on("click",".checkbox,.radio",function(){if(0==$(this).parents("label").length&&!$(this).is("label")){var e=$(this).find("input");e.is("[type=checkbox]")&&e.prop("checked")?e.prop("checked",!1).trigger("set.appearance"):e.prop("checked",!0).trigger("set.appearance")}}),$(".checkbox,.radio").trigger("set.appearance"),$("form").on("reseting",function(){$(this).find(".checkbox,.radio").trigger("set.appearance")}),$(".form-group").on("error",function(e,t){$(this).focus().addClass("has-error").one("keyup change",function(e){return 13==e.keyCode?!1:($(this).removeClass("has-error"),void 0)}),t&&$(this).find(".error-feedback").text(t)}).on("warning",function(e,t){$(this).focus().addClass("has-warning").one("keyup change",function(e){return 13==e.keyCode?!1:($(this).removeClass("has-warning"),void 0)}),t&&$(this).find(".warning-feedback").text(t)}),$("[data-require]").on("click.check",function(){for(var e=$(this).data("require").split(" "),t=$(this).parents("form").get(0)||"body",n=0;n<e.length;n++){var a=$("[name="+e[n]+"]",t);if(0==a.length)return!0;if(!a.val()||a.val()==a.attr("placeholder"))return a.trigger("warning").focus(),!1}$(this).trigger("validated")}),$("body").on("submit.ajax",".ajax-form",function(e,data){e.preventDefault();var form=$(this);if(form.is(".instant-form")&&!data)return!1;var serialize=data||form.serializeJson(),type=form.attr("method")||"get",url=form.attr("action"),success=form.attr("data-success")||function(){},failed=form.attr("data-failed")||function(){};form.addClass("waiting").find("[type=submit]").attr("disabled",!0);var request=form.data("request");request||(request=new Unreal.ajax,form.data("request",request)),request.start({type:type,data:serialize,url:url,success:function(json){eval(success).call(form,json,data),form.trigger("request.success",json)},failed:function(json){eval(failed).call(form,json,data),form.trigger("request.error",json)},end:function(){form.removeClass("waiting").find("[type=submit]").attr("disabled",!1)}})}),$("body").on("change",".instant-form",function(e){var t=$(e.target);if(t.is("[type=checkbox]")||t.is("[type=radio]")){var n=t.attr("name"),a=$(this).find('[name="'+n+'"]');a.length&&(t=a)}var r=$(this).find(".params input,input.params").add(t);r=r.serializeJson(),$(this).trigger("submit.ajax",r)}),Unreal.placeholder=function(){function e(){var e=document.createElement("input");return"placeholder"in e}if(e()||$("[placeholder]").each(function(){var e=$(this);if(""==e.val()){var t=e.attr("placeholder"),n=e.css("color");if(e.is("[type=password]")){var a=$("<input type='text'>").val(t).css("color","#ccc").addClass(e.attr("class"));e.after(a).hide(),a.one("focus",function(){a.remove(),e.show().focus()})}e.val(t).css("color","#ccc").one("focus",function(){e.val("").css("color",n)})}}),!Unreal.placeholder.rewriteVal){Unreal.placeholder.rewriteVal=!0;var t=$.fn.val;$.fn.val=function(e){if(arguments.length)return t.call(this,e);var n=t.call(this);return n==$(this).attr("placeholder")?"":t.call(this)}}},Unreal.placeholder(),Unreal.textScroll=function(e){function t(){var e=GetTextWidth(n),a=e/60*1e3,r=0;e<n.outerWidth()+1&&(e=0,r=1),n.animate({left:-e},a,"linear",function(){n.css({left:0,opacity:r}),n.animate({opacity:1},500,t)})}e=$(e);var n=e.wrapInner("<span></span>").children();e.css({"white-space":"nowrap",overflow:"hidden"}),n.css({display:"block",position:"relative"}),t()},Unreal.textScroll(".text-scroll"),Unreal.fixedBackground=function(e){e=e||".fixed-background",$(window).on("resize.fixedbackground",function(){$(e).each(function(){var e=$(this),t=e.data("ratio");if(!t)return!0;t=ConvertRatio(t);var n=e.offset().top+e.outerHeight(),a=e.data("footline");a="window"==a?$(window).height():"footer"==a?$("footer").offset().top:n,a>n&&e.css("min-height",e.height()+a-n),e.outerHeight()/e.outerWidth()<t?e.css("background-size","100%"):e.css("background-size","auto 100%")})}).trigger("resize.fixedbackground")},Unreal.fixedBackground();