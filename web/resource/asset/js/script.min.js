function JsonToArray(e,t){var a=[];return e?($.each(e,function(e,n){void 0!=n[t]&&a.push(n[t])}),a):a}function GetMemberList(e){return e=e||0,$.post("/backend/user/get_user_by_project_id",{ProjectId:e})}function EditSuccess(e){if(0==e.Result){var t=$(this).parents(".work-panel"),a=t.data("from"),n=$(a).getRow();a=n.setRowData(e.Data).refresh(),t.data("from",a),n.is(".active")&&a.addClass("active"),document.getElementById("calendar")&&($("#calendar").fullCalendar("removeEvents"),$("#calendar").fullCalendar("refetchEvents"))}}function AddSuccess(e){0==e.Result&&(alert(e.Msg),this.get(0).reset(),$.reload(1.5))}function AddProjectSuccess(e){0==e.Result&&($(this).get(0).reset(),$(this).parents(".work-panel").close(),$("#project-member").find("[name=ProjectId]").val(e.Data.Id),$("#project-member").open())}function AddMember(e){var t=$(this),a=e.Data,n=t.parents(".popover"),r=n.data("from").parents(".work-panel");if(0==e.Result){var o=n.find(".list").find("ul"),i=o.find("li").filter(function(){return $(this).getRowData("UserId")==a.UserId});if(i.length){var s=t.find("input").val();return s='"'+s+'" 已存在',alert(s),!1}var d=GenerateList([a],"#member-tpl");o.prepend(d),d.find("input").click(),alert("添加成功"),t.find("input").val("");var l=r.data("member")||DataBase.Member;l||(l=[]),l=l.slice(),l.push(a),r.data("member",l)}else alert(e.Msg)}function ChecklistClone(e){var t=e.clone();return t.find("[type=text]").val(""),t.find("[type=checkbox]").prop("checked",!1).parents(".checkbox").removeClass("checked"),t}function loadSkin(){$.ajax({type:"GET",url:"/backend/theme/get_themes",data:"",cache:!1,success:function(e){e=JSON.parse(e),0==e.Result?(window.sessionStorage.skinsData=JSON.stringify(e),skinCallBack(e)):alert(e.Msg)},error:function(){alert("服务器异常!")}})}function skinCallBack(e){var t=e,a=0,n="",r=0;for(r=t.Data.length;r>a;a++)n+=$("#themeId").val()==t.Data[a].Id?" <div class='divClickImg' themeID='"+t.Data[a].Id+"' headerBg='"+t.Data[a].Color+"' bgSrc='"+t.Data[a].BgImg+"' onclick='click_btn(this);'><img alt='skin"+a+"' src='"+t.Data[a].Thumb+"'/></div>":" <div class='divImg' themeID='"+t.Data[a].Id+"' headerBg='"+t.Data[a].Color+"' bgSrc='"+t.Data[a].BgImg+"' onclick='click_btn(this);'><img alt='skin"+a+"' src='"+t.Data[a].Thumb+"'/></div>";$("#skinBox").empty().append(n)}function click_btn(e){$(e).attr("class","divClickImg").siblings().attr("class","divImg"),$("#viewport>.background").css({background:"url("+$(e).attr("bgSrc")+") no-repeat center center"}),$("#layout>.header").css({background:""+$(e).attr("headerBg")})}function setSkin(e){$.ajax({type:"POST",url:"/backend/user/set_theme",data:{ThemeId:e},success:function(e){e=JSON.parse(e),0==e.Result?(alert(e.Msg),$("#replaceSkin").close()):alert(e.Msg)},error:function(){alert("服务器异常!")}})}String.prototype.includes||(String.prototype.includes=function(e,t){"use strict";return"number"!=typeof t&&(t=0),t+e.length>this.length?!1:-1!==this.indexOf(e,t)}),$("form").attr("autocomplete","off"),$("body").on("click","a[href='#']",function(e){e.preventDefault()});var Func={};Func.LogOut=function(){window.location="/backend/login/logout"},$.fn.isIn=function(e){return this.is(e)||$(e).find(this).length>0},$.fn.findIn=function(e){return this.is(e)?this:this.find(e)},$.fn.getRow=function(e){e=e||".item";var t=$(this).is(e)?$(this):$(this).parents(e).eq(0);return t},$.fn.getRowData=function(key,row){var item=$(this).getRow(row),data=item.data("data")||eval(item.data("refer"))||{};return key?data[key]:data},$.fn.setRowData=function(e,t){var a=$(this).getRow(t),n=$(this).getRowData(t),r=$.extend(n,e);return a.data("data",r),a},$.fn.refresh=function(){var e=$(this).data("data"),t=$(this).data("tpl");if(!t)return $(this);var a=GenerateList(e,t);return $(this).after(a).remove(),a.trigger("refresh.data"),a},$.fn.fillSelect=function(e,t,a){var n=$(this),r="";$.each(e,function(e,n){r+='<option value="'+n[t]+'">'+n[a]+"</option>"}),n.children().filter(function(){var e=$(this).val();return-1!=e&&0!=e}).remove(),n.append(r);var o=n.data("value");return o&&n.find("option").filter(function(){var e=$(this).val();return $.isArray(o)?o.includes(e):e==o}).prop("selected",!0),n.trigger("set.data",{data:e})},moment.fn.getTime=function(e){return e=e||13,this.toDate().getTime().toString().slice(0,e)},$.fn.open=function(){return $(this).each(function(){$(this).addClass("open").trigger("open")}),this},$.fn.close=function(){return $(this).each(function(){$(this).removeClass("open").trigger("close")}),this},$("body").on("click","[data-dismiss]",function(){var e=$(this).data("dismiss");$(this).parents("."+e).close()}),DataBase.handler=$({}),DataBase.set=function(e,t){DataBase[e]=t,DataBase.handler.trigger("change.all",{value:t}),DataBase.handler.trigger("change."+e,{value:t}),$("[data-listener='"+e+"']").trigger("database.change",{value:t})},State.handler=$({}),State.set=function(e,t){State[e]=t,State.handler.trigger("change",{value:t})},State.on=function(e,t,a,n){State.handler.on(e,t,a,n)},DataBase.Today={start:function(){return moment().set({hour:0,minute:0,second:0}).getTime(10)}(),end:function(){return moment().set({hour:23,minute:59,second:59}).getTime(10)}()},Unreal.ajax.set({error:function(){alert("请求失败，请重试")},badResponse:function(e){return 0!=e.Result?(alert(e.Msg),!1):void 0}});var DefaultFormat="YYYY/MM/DD HH:mm";$(".sidebar .nav").find("a").filter(function(){return window.location.pathname==$(this).attr("href")}).addClass("active").parents("li").addClass("active"),(0==window.location.pathname.indexOf("/backend/task")||0==window.location.pathname.indexOf("/backend/milestone"))&&$(".sidebar").find('a[href="/backend/project/overview"]').addClass("active").parents("li").addClass("active"),$(".sidebar .user a").click(function(){var e=$(this);$(".personal-card").stop().fadeIn(200),$("body").off("click.personalcard.hide").on("click.personalcard.hide",function(t){var a=$(t.target);a.isIn(".personal-card")||a.isIn(e)||($(".personal-card").stop().fadeOut(200),$("body").off("click.personalcard.hide"))})}),$("#userSetting").on("mouseover",function(){$(this);$(".personal-card").stop().fadeIn(200)}).on("mouseout",function(){$(".personal-card").stop().fadeOut(200),$("body").off("click.personalcard.hide")}),$("#headerMenu").on("mouseover",function(){var e=$(this).find(".menu");e.addClass("active"),$(".menu-card").stop().fadeIn(200)}).on("mouseout",function(){var e=$(this).find(".menu");e.removeClass("active"),$(".menu-card").stop().fadeOut(200)}),$("body").on("open",".popover,.dialog",function(){var e=$(this);e.show(),setTimeout(function(){e.addClass("in")},50),e.is(".message-popover")||$(".popover").not(".message-popover").not(this).close()}).on("close",".popover,.dialog",function(){var e=$(this);e.removeClass("in").transitionEnd(function(){e.is(".in")||(e.hide(),e.is(".instant")&&e.remove())})}).on("click",".dialog .outer",function(e){$(e.target).is(this)&&$(this).data("allow-close")&&$(this).parents(".dialog").close()}),$.fn.popover=function(){var e=$(this),t=e.data("target")||e.attr("href"),a=e.offset().top-$(window).scrollTop()+50,n=e.offset().left,r=$(window).height()-400;a>r&&(a=r);var o=$(window).width()-300;return n>o&&(n=o),$("#dbl-new-task").hasClass("open")?(a=$("#dbl-new-task").offset().top+100,n=$("#dbl-new-task").offset().left+200,$(t).css({right:"initial"}),$(t).data("from",e).css({top:a,left:n}).open().trigger("popover.open",e.data()),void 0):($(t).data("from",e).css({top:a,left:n}).open().trigger("popover.open",e.data()),void 0)},$("body").on("click",'[data-toggle="popover"]',function(){$(this).popover()}).on("click",".popover",function(e){e.stopPropagation()}).on("click",function(){$(".popover").close()}),$.fn.dropdown=function(e){return"click"==e||"hover"==e&&$(this).each(function(){var e=$(this);return e.open(),void 0!==e.data("active")?!0:(e.on("mouseenter",function(){e.data("active",!0)}).on("mouseleave",function(){e.data("active",!1),setTimeout(function(){e.data("active")||e.close()},500)}),void 0)}),this},$("body").on("click",'[data-toggle="dropdown"]',function(e){e.preventDefault(),$(this).parents(".dropdown").open()}).on("click",function(e){var t=$(e.target).parents(".dropdown");$(".dropdown").not(t).close()}),$("body").on("mouseenter","[data-toggle=dropdown][data-trigger=hover]",function(){$(this).parents(".dropdown").dropdown("hover")});var arrayProject=[],arrayCondition=[],arrayValue={project:"",condition:""};if($(".project-selector-popover").on("change",".list input",function(){var e=($(this),function(){return $(".projectlist").find(".item").filter(function(){return $(this).find("input").prop("checked")}).each(function(){arrayProject.push($(this).getRowData().Id)}),$(".conditionlist").find(".item").filter(function(){return $(this).find("input").prop("checked")}).each(function(){arrayCondition.push($(this).data("type"))}),{project:arrayProject,condition:arrayCondition}}());arrayValue=e,arrayProject=[],arrayCondition=[]}).on("keyup",".search",function(){var e=$(this).find("input").val(),t=$(this).parents(".popover"),a=t.data("data"),n=(t.data("value"),function(){return e?$(a).filter(function(){return this.Title.indexOf(e)>=0}).get():a}());t.trigger("refresh.project",{data:n})}).on("refresh.project",function(e,t){$(this).find(".list ul").empty().append(function(){return GenerateList(t.data,"#project-tpl-dropdown")})}).on("click",".get-new-task",function(){if(null==arrayValue)return alert("请至少选择一项"),void 0;var e={startDate:DataBase.Today.start,DueDate:DataBase.Today.end,ProjectId:arrayValue.project,Type:arrayValue.condition},t="/backend/calendar/calendar_tasks_by_params",a=$("#calendar").fullCalendar("getView").name;"month"==a&&(e.startDate=DataBase.MonthObj.startDate,e.DueDate=DataBase.MonthObj.DueDate),"agendaWeek"==a&&(e.startDate=DataBase.WeekObj.startDate,e.DueDate=DataBase.WeekObj.DueDate),$.post(t,e,function(e){for(var t=e.Data,a=[],n=0,r=t.length;r>n;n++)switch(parseInt(t[n].Type)){case 1:a.push({id:t[n].Id,title:t[n].Title,start:moment.unix(t[n].StartDate),end:moment.unix(t[n].DueDate),color:"#CBEFFF",backgroundColor:"#CBEFFF",borderColor:"#00ACFE",textColor:"#000000"});break;case 2:a.push({id:t[n].Id,title:t[n].Title,start:moment.unix(t[n].StartDate),end:moment.unix(t[n].DueDate),color:"#CBEFFF",backgroundColor:"#DEDEDE",borderColor:"#585858",textColor:"#000000"});break;case 3:a.push({id:t[n].Id,title:t[n].Title,start:moment.unix(t[n].StartDate),end:moment.unix(t[n].DueDate),color:"#CBEFFF",backgroundColor:"#FFF7D8",borderColor:"#FFD83F",textColor:"#000000"})}$("#calendar").fullCalendar("removeEvents"),$("#calendar").fullCalendar("addEventSource",a),$("#calendar").fullCalendar("rerenderEvents")}),$(this).parents(".popover").close()}),!DataBase.Member){var url=window.location.href,urlArr=url.split("/");"update"==urlArr[urlArr.length-1]||GetMemberList(DataBase.ProjectId).done(function(e){DataBase.set("Member",e.Data)})}$("select[data-listener=Projects]").on("database.change",function(e,t){$(this).fillSelect(t.value,"Id","Title")}),$("select[data-listener=MyProjects]").on("database.change",function(e,t){$(this).fillSelect(t.value,"Id","Title")}),function(){var e=window.location.href,t=e.split("/");"update"!=t[t.length-1]&&$.post("/backend/project/all_project").done(function(e){DataBase.set("Projects",e.Data.Projects),DataBase.set("MyProjects",e.Data.MyProjects)})}(),$("body").on("click",".task-list .delete-btn",function(e){e.preventDefault();var t=$(this).getRow(),a=t.getRowData();return t.is(".waiting")?!1:($.confirm("确定要删除“"+a.Title+"”吗？").then(function(){t.addClass("waiting"),this.close(),$.post("/backend/task/delete",{Id:a.Id}).done(function(){alert("删除成功"),t.trigger("row.delete")}).always(function(){t.removeClass("waiting")})}),void 0)}).on("row.delete",function(e){var t=$(e.target);t.remove()}),$("body").on("click",".work-panel .delete-btn",function(e){e.preventDefault();var t=$(this).parents(".work-panel").data("from").getRow(),a=t.getRowData();if(t.is(".waiting"))return!1;var n=$(this);$.confirm("确定要删除“"+a.Title+"”吗？").then(function(){t.addClass("waiting"),this.close(),$.post("/backend/task/delete",{Id:a.Id}).done(function(e){document.getElementById("calendar")&&$("#calendar").fullCalendar("removeEvents",a.Id),alert(""+e.Msg),t.trigger("row.delete"),n.parents(".work-panel").close()}).always(function(){t.removeClass("waiting")})})}).on("row.delete",function(e){var t=$(e.target);t.remove()}),$("body").on("click",".edit-btn",function(){var e=null;e=document.getElementById("calendar")?$(this).data("data"):$(this).getRowData();var t=$(this).data("target")||$(this).attr("href"),a=$(t).find("form").attr("action"),n=$(this);$(t).addClass("waiting"),$.get(a,{Id:e.Id}).done(function(e){n.setRowData(e.Data),$(t).loadData(e.Data).removeClass("waiting")})}),$(".task-list").on("click",".progress,.checkbox",function(){var e=$(this),t=$(this).getRowData(),a=100==t.CompleteProgress?0:1,n=a?100:0;$.post("/backend/task/change_progress",{TaskId:t.Id,Progress:n}).done(function(t){if(0==t.Result){alert(t.Msg);var a=e.trigger("progress.change").setRowData({CompleteProgress:n}).refresh();window.clearTimeout(a.timer),a.timer=window.setTimeout(function(){a.stop().fadeToggle("slow"),window.clearTimeout(a.timer)},300)}})});var flagFirst=0;$("body").on("click",'[data-toggle="work-panel"]',function(e){e.preventDefault();var t=$(this).data("target")||$(this).attr("href");$(t).data("from",$(this)).open(),$(".work-panel").not(t).close(),$(t).find("[name=Title]").focus(),$(".item").removeClass("active");var a=$(this).parents(".item");a.addClass("active"),flagFirst++,$("body").off("click.hide.work.panel").on("click.hide.work.panel",function(e){var t=$(e.target);return 1==flagFirst?(flagFirst++,void 0):(t.isIn(".work-panel")||t.isIn(".edit-btn")||t.isIn(".available")||t.isIn(".next")||t.isIn(".prev")||t.isIn("i.fa.fa-chevron-left")||t.isIn("i.fa.fa-chevron-right")||t.isIn(".erase-btn")||t.isIn(".submenu")||t.isIn(".icon-delete-avatar")||t.isIn(".daterangepicker.dropdown-menu")||($(".work-panel").close(),$("body").off("click.hide.work.panel"),a.removeClass("active"),flagFirst=0,document.getElementById("calendar")&&$("#calendar").fullCalendar("rerenderEvents")),void 0)})}).on("open",".work-panel",function(){$("#layout").addClass("work-panel-open")}).on("close",".work-panel",function(){0==$(".work-panel").filter(".open").length&&$("#layout").removeClass("work-panel-open")}).on("click",'[data-dismiss="work-panel"]',function(){document.getElementById("calendar")&&$("#calendar").fullCalendar("rerenderEvents")}),$(".work-panel .is-milestone").on("set.value",function(e,t){var a=$(this),t=t.value;t&&(a.find("input").prop("disabled",!1).prop("checked",1==t.value).trigger("set.appearance"),1==t.value?a.find(".text").text("已标记为里程碑"):a.find(".text").text("标记为里程碑"))}).on("change",function(){var e=$(this),t={};t.value=e.find("input").prop("checked")?1:0;var a=e.parents(".work-panel").find("form");a.find("[name='IsMilestone']").val(t.value).trigger("change"),e.setValue(t)}),$(".work-panel").on("set.value","[name='IsMilestone']",function(e,t){var a=$(this).parents(".work-panel").find(".is-milestone");a.setValue(t)}),$(".user-selector").on("set.value",function(e,t){$(this).find("span.avatar").remove(),"avatar-edit-tpl-user"==$(this).attr("tpl")&&$(this).addClass("user-selector-Member"),$(this).prepend(function(){var e=GenerateList(t.value,$(this).attr("tpl"));return e}),$(this).find(".avatar-add").data("value",t.value),$(this).find("input").val(JsonToArray(t.value,"UserId").join())}).on("set.data",function(e,t){$(this).find(".avatar-add").data("data",t.data)}).on("click",".delete",function(){var e=$(this).parents(".avatar"),t=e.data("id"),a=e.siblings("input"),n=e.siblings(".avatar-add"),r=n.data().value,o=$(n.attr("href"));$.each(r,function(e,a){return a.UserId==t?(r.splice(e,1),!1):void 0});var i=function(){var e=a.val().split(","),n=e.indexOf(t);return e.splice(n,1),e.join()}();a.val(i);var s=o.data("url"),d=o.data("type"),l=e.parents("form").find("[name=Id]").val();l?(e.prop("disabled",!0).hide(),$.post(s,{UserId:t,Type:d,Id:l}).done(function(t){e.prop("disabled",!1),0==t.Result&&(EditSuccess.call(e,t),e.remove())})):e.remove()}),$(".user-selector-popover").on("popover.open",function(e,t){for(var a=$(this).data("from"),n=t.data||$(a).parents(".work-panel").data("member")||DataBase.Member,r=t.value,o=JsonToArray(n,"UserId"),i=JsonToArray(r,"UserId"),s=0;s<i.length;s++)o.indexOf(i[s])<0&&n.push(r[s]);var d=i;$(this).data("data",n).data("value",d).trigger("refresh.user",{data:n,value:d})}).on("refresh.user",function(e,t){$(this).find(".list ul").empty().append(function(){return GenerateList(t.data,"#member-tpl")}),$(this).loadData({UserId:t.value})}).on("change",".list input",function(){var e=$(this),t=e.parents(".popover"),a=t.data("from");1==t.data("limit")&&t.find(".list").find("input:checked").not(this).click();var n=function(){var t=[];return e.parents(".list").find(".item").filter(function(){return $(this).find("input").prop("checked")}).each(function(){t.push($(this).data("data"))}),t}();a.parents(".user-selector").setValue(n);var r=t.data("url"),o=t.data("type"),i=a.parents("form").find("[name=Id]").val(),s=e.getRowData("UserId");i&&(e.prop("disabled",!0),$.post(r,{UserId:s,Type:o,Id:i}).done(function(t){e.prop("disabled",!1),0==t.Result&&EditSuccess.call(a,t)}))}).on("keyup",".search",function(){var e=$(this).find("input").val(),t=$(this).parents(".popover"),a=t.data("data"),n=(t.data("value"),function(){return e?$(a).filter(function(){return this.UserName.indexOf(e)>=0}).get():a}());t.find(".list ul .item").each(function(){var e=$(this).data("data").UserId;$(this).hide();for(var t=0,a=n.length;a>t;t++)e==n[t].UserId&&$(this).show()})}).on("click",".add-button",function(e){e.preventDefault(),$(this).parents(".add-button-wrap").hide().siblings("form").show().find("input").focus()}).on("blur",".add-member form",function(){var e=$(this),t=setTimeout(function(){e.hide().siblings(".add-button-wrap").show()},100);e.data("timeout",t)}).on("focus",".add-member form",function(){var e=$(this).data("timeout");clearTimeout(e)}),$(".checklist-group").on("set.value",function(e,t){var a=ChecklistClone($(this).find(".item").eq(0)),n=function(e){var n=$();return e?($.each(t.value,function(e,t){var r=a.clone().data("data",t);r.find(".form-control-text").text(t.Title),r.find("[type=checkbox]").prop("checked",1==t.IsComplete),n=n.add(r)}),n):($.each(t.value,function(e,t){var r=a.clone().data("data",t);r.find("[type=text]").val(t.Title),r.find("[type=checkbox]").prop("checked",1==t.IsComplete),n=n.add(r)}),n.add(a))}($(this).is(".readonly"));$(this).children("dd").empty().append(n).find("[type=checkbox]").trigger("set.appearance")}).on("change",function(e){e.stopPropagation();var t=$(e.target),a=t.parents("form").find("[name=Id]").val();if(!a)return!0;var n=t.getRowData(),r=t.getRow(),o=r.find("[type=text]").val(),i=r.find("[type=checkbox]").prop("checked")?1:0;n.Id?(t.is("[type=checkbox]")&&t.trigger("set.appearance"),$.post("/backend/checklist/edit",{Id:n.Id,Title:o,IsComplete:i})):t.is("[type=text]")?$.post("/backend/checklist/create",{TaskId:a,Title:o}).done(function(e){0==e.Result&&t.setRowData(e.Data)}):t.is("[type=checkbox]")&&t.prop("checked",!1)}).on("keydown",function(e){if(13==e.keyCode&&""!=$(e.target).val()){e.preventDefault(),$(e.target).parents(".item").siblings().filter(function(){return!$(this).find("[type=text]").val()}).remove();var t=ChecklistClone($(e.target).getRow());$(this).children("dd").append(t),t.find("[type=text]").focus()}}).on("click",".erase-btn",function(e){e.preventDefault();var t=$(this).parents("form").find("[name=Id]").val(),a=$(this).getRow(),n=a.getRowData();t&&""!=$(this).parent().find("[name='Checklist']").val()&&($.post("/backend/checklist/delete",{Id:n.Id}),0==a.siblings().length&&a.after(ChecklistClone(a)),a.remove())});var _val=$.fn.val,specialVal=function(e){if($(this).is(".date-picker")){if(arguments.length){e=e.toString();var t;if(e&&0!=e){10==e.length&&(e+="000"),e=parseInt(e);var a=this.data("myformat")||DefaultFormat;t=moment(e).format(a)}else t="";return _val.call(this,t)}var t,e=_val.call(this);return t=e?moment(new Date(e)).getTime(10):""}return arguments.length?_val.call(this,e):_val.call(this)};$(".work-panel").on("data.beforeload data.beforeserialize",function(){$.fn.val=specialVal}).on("data.afterload data.afterserialize",function(){$.fn.val=_val}),void function(){var e=$(".time-selector"),t=e.find(".time-button"),a=e.find(".date-range-picker");$(".time-selector").on("change",".date-range-picker",function(){e.find('[type="hidden"]').remove(),t.addClass("disabled"),a.removeClass("disabled");var n=a.val().split("-")[0],r=a.val().split("-")[1];n=moment(n).getTime(10),r=moment(r).getTime(10);var o=$('<input type="hidden" name="StartDate" value="">').val(n),i=$('<input type="hidden" name="EndDate" value="">').val(r);o.add(i).appendTo(e)}).on("change.on",".pill",function(){e.find('[type="hidden"]').remove(),a.addClass("disabled"),t.removeClass("disabled");var n=$(this).data("value");$('<input type="hidden" name="Time" value="">').val(n).appendTo(e)})}(),$(".work-panel").on("set.value","[name=ProjectId]",function(e,t){"0"==t.value&&$(this).prop("disabled",!1),$(this).on("change",function(){})}),$(".work-panel").on("set.value","[name='ProjectId'].form-control-text",function(e,t){var a=$(DataBase.Projects).filter(function(){return this.Id==t.value});a.length?$(this).text(a[0].Title):$(this).text("无")}),$(".work-panel").on("set.value","[name=IsCollected]",function(e,t){1==t.value?($(this).parents(".no-time-group").show().siblings(".time-picker-group").hide().find("input").val(""),$(this).parents(".work-panel").find(".collect-button").addClass("active")):($(this).parents(".no-time-group").hide().siblings(".time-picker-group").show(),$(this).parents(".work-panel").find(".collect-button").removeClass("active"))}).on("click",".collect-button",function(){var e=$(this).hasClass("active")?0:1;if($(this).parents(".work-panel").find("[name=IsCollected]").setValue(e),0==e){var t=moment().format(DefaultFormat),a=moment().add({hour:1}).format(DefaultFormat);$(this).parents(".work-panel").find("[name=StartDate]").val(t),$(this).parents(".work-panel").find("[name=DueDate]").val(a)}$(this).parents(".work-panel").find(".time-picker-group").trigger("change")}).on("data.beforeload",function(e,t){t.IsCollected=0==t.StartDate&&0==t.DueDate?1:0}),$(".work-panel").on("reseting",function(){$(this).find(".user-selector,.checklist-group").setValue([]),$(this).find("[name='IsMilestone']").setValue(0),$(this).find("[name=IsCollected]").setValue(0)}),$("#new-task,#new-project").on("open reseting",function(){var e=[{Avatar:DataBase.UserInfo.Avatar,UserId:DataBase.UserInfo.Id,UserName:DataBase.UserInfo.Name}];$(this).find("[name=ProjectManagerId],[name=AssignedTo]").setValue(e)}),$("#new-task,#dbl-new-task").on("open reseting",function(){var e=moment().format(DefaultFormat),t=moment().add({hour:1}).format(DefaultFormat);$(this).find("[name='StartDate']").val(e),$(this).find("[name='DueDate']").val(t)}).on("change","[name=StartDate]",function(){var e=$(this).val(),t=moment(e).add({hour:1}).format(DefaultFormat);$(this).parents(".work-panel").find("[name=DueDate]").val(t)}),$("#edit-task").on("change","[name=StartDate]",function(){var e=$(this).val(),t=$(this).parents(".work-panel").find("[name=DueDate]"),a=t.val();if(e>a){var n=moment(e).add({hour:1}).format(DefaultFormat);t.val(n)}}),$("#new-project").on("open reseting",function(){var e=moment().format("YYYY/MM/DD"),t=moment().add({day:7}).format("YYYY/MM/DD");$(this).find("[name='StartDate']").val(e),$(this).find("[name='DueDate']").val(t)}),$(".work-panel").on("change","[name=ProjectId]",function(){var e=$(this).parents(".work-panel");GetMemberList(this.value).done(function(t){e.data("member",t.Data)})}).on("close",function(){$(this).removeData("member")}),$(function(){if(window.sessionStorage.skinsData){var e=JSON.parse(window.sessionStorage.skinsData);0==e.Result?skinCallBack(e):alert(e.Msg)}else loadSkin()}),$("#replaceSkin button[type=button]").on("click",function(){$("#skinBox>div").each(function(){"divClickImg"==$(this).attr("class")&&setSkin($(this).attr("themeID"))})});